import{r as gt}from"../chunks/index.C5ON1TrN.js";import{a as f,t as T,c as H,b as ft}from"../chunks/disclose-version.DwtFBC9D.js";import{c as x,r as b,p as fe,t as ee,a as me,q as Q,g as t,S as oe,f as N,s as z,aT as qt,d as V,n as Ke,al as rt,Q as qe,am as Bt,an as mt,aU as aa,A as bt,K as Ae,aS as Ce,J as It,aV as na}from"../chunks/runtime.B-tQERhy.js";import{s as Me}from"../chunks/snippet.DGJzwTXS.js";import{i as U,p as re}from"../chunks/if.DYHPrnE1.js";import{s as xe,b as J,d as We,a as ce,e as Ie,f as we}from"../chunks/store.hrIEzNxT.js";import{c as Je,a as ia}from"../chunks/index-client.BfaqMVnR.js";import{c as Ee,b as yt}from"../chunks/preload-helper.Cgn74BMC.js";import{U as Ne,F as sa,t as ge,G as Le,H as Xe,I as he,J as tt,m as pe,e as lt,K as Lt,L as Qe,M as jt,N as oa,O as ra,Q as Be,R as At,S as Oe,T as da,V as la,a as zt,q as ae,W as ca,D as Ve,X as _a,Y as at,Z as ua,_ as va,$ as pa,a0 as ht,a1 as ga,a2 as Ge,a3 as Re,a4 as fa,a5 as Ue,C as ct,a6 as ma,k as _e,a7 as ba,a8 as ya,a9 as Mt,aa as wt,ab as xt,ac as ha,ad as kt,ae as Te,af as $t,ag as wa,ah as nt,ai as xa,aj as Ft,ak as ka,al as $a,am as Et,c as Ut,d as it,an as _t,f as Gt,ao as Ea,ap as Sa,n as Da,aq as St,ar as Ca,as as be,at as Pa,au as Dt,av as Oa,aw as Ra,ax as Ta,ay as qa,az as Ba,aA as Ia,aB as La,j as ye,l as ja,aC as Aa,aD as za,aE as Ma,aF as Fa}from"../chunks/modal.DQW4ZWZ4.js";import{p as K,l as Ze,s as Ua}from"../chunks/props.Pqwi89p5.js";import{I as le,h as Ct,a as ut,k as Ga,l as Ka,e as Na}from"../chunks/Icon.CwQkWwrI.js";import{s as $e,e as ze,i as He,t as Kt,f as Nt,d as Pt,g as Va,a as Vt}from"../chunks/index.CapXeD3F.js";import{f as Wa,a as Ye}from"../chunks/Modal.Bvi9X32r.js";import{p as vt}from"../chunks/stores.Djv4k36v.js";import{w as Ja,g as Se,d as Fe,c as Qa}from"../chunks/entry.Cv1PstCO.js";import{draggable as Ya,dropTargetForElements as Wt}from"../chunks/element-adapter.CmHsh92p.js";import{i as Jt}from"../chunks/lifecycle.B6hsrwH2.js";import{g as Ha,b as Ot}from"../chunks/hydration.BcoAblzY.js";import{attachClosestEdge as Qt,extractClosestEdge as Yt}from"../chunks/closest-edge.DKVUyjvI.js";var Xa=T('<a class="primo-button svelte-1hck776" aria-label="See all sites" href="/"><!></a>');function Za(n){const e=xe(),r=()=>J(sa,"$loadingSite",e);var o=Xa(),l=x(o);U(l,r,c=>{Ne.Spinner(c,{})},c=>{le(c,{icon:"ion:chevron-back-sharp"})}),b(o),f(n,o)}const en=Ja([]);async function tn(n){n.depends("app:data");const{supabase:e,session:r}=await n.parent(),{site:o,page:l,page_type:c}=n.params,k=((l==null?void 0:l.split("/"))??[]).at(-1)??"";if(o==="playground")return n.data;if(!e)throw gt(303,"/auth");const B=async()=>(await e.from("sites").select("*, fields(*), entries(*)").filter("id","eq",o).single()).data,j=async()=>c?null:(await e.from("pages").select("*, entries(*), page_type!inner(*, fields(*), entries(*), sections(*))").match({"page_type.site":o,slug:k}).single()).data,[D,w]=await Promise.all([B(),j()]);if(!w&&k!=="")throw gt(303,`/${o}/index`);const m={collaborator:async()=>{const{data:$,error:g}=await e.from("collaborators").select("*").match({user:r.user.id,site:o}).single();return $},pages:async()=>{const{data:$,error:g}=await e.from("pages").select("*, entries(*), page_type!inner(id, site)").eq("page_type.site",o).order("created_at",{ascending:!0});return $.map(i=>({...i,page_type:i.page_type.id}))},page_types:async()=>{const{data:$}=await e.from("page_types").select("*, fields(*), entries(*)").match({site:o}).order("created_at",{ascending:!0});return $},symbols:async()=>{const{data:$,error:g}=await e.from("symbols").select("*, entries(*), fields(*)").match({site:o}).order("created_at",{ascending:!1});return $},sections:async()=>{if(c){const{data:$=[],error:g}=await e.from("sections").select("*, entries(*)").eq("page_type",c).order("index",{ascending:!0});return $}else{const{data:$=[]}=await e.from("sections").select("*, page, page_type, entries(*), master(id, symbol, index)").match({page:w.id}).order("index",{ascending:!0});return $}}},[y,C,P,M,E]=await Promise.all([m.collaborator(),m.pages(),m.page_types(),m.symbols(),m.sections()]);let q=null;if(c){const{data:$,error:g}=await e.from("page_types").select("*, fields(*), entries(*)").eq("id",c).single();q=$}return{role:(y==null?void 0:y.role)||"DEV",site:D,page:w,page_type:q,pages:C,page_types:P,sections:E,symbols:M}}const Ii=Object.freeze(Object.defineProperty({__proto__:null,load:tn},Symbol.toStringTag,{value:"Module"}));var an=(n,e,r,o)=>{Q(e,!t(e)),r()?r()():o("click")},nn=T('<span class="key-hint" aria-hidden=""> </span>'),sn=T('<div class="svg"><!></div> <span class="label"> </span>',1),on=T('<!> <span class="label"> </span>',1),rn=T('<div class="svg"><!></div>'),dn=T("<!> <!>",1),ln=T("<span> </span>"),cn=T('<button class="primo-button svelte-1dmzqj9"><!></button>');function Pe(n,e){fe(e,!0);const r=xe(),o=()=>J(Le,"$mod_key_held",r),l=Je();let c=K(e,"id",3,null),v=K(e,"title",3,""),k=K(e,"label",3,null),B=K(e,"key",3,null),j=K(e,"icon",3,null),D=K(e,"svg",3,null),w=K(e,"disabled",3,!1),m=K(e,"onclick",3,null),y=K(e,"loading",3,!1),C=K(e,"active",3,!1),P=K(e,"buttons",3,null),M=K(e,"type",3,null),E=K(e,"style",3,""),q=oe(!1);var $=cn();$.__click=[an,q,m,l];var g=x($);U(g,()=>j()||D(),i=>{var a=dn(),_=N(a);U(_,B,u=>{var p=nn(),d=x(p);ee(()=>ce(d,`⌘${B().toUpperCase()??""}`)),b(p),ee(()=>ge(p,"active",o())),f(u,p)});var s=z(_,2);U(s,y,u=>{var p=H(),d=N(p);Ee(d,()=>Ne.Spinner,(h,S)=>{S(h,{})}),f(u,p)},u=>{var p=H(),d=N(p);U(d,()=>k()&&D(),h=>{var S=sn(),L=N(S),O=x(L);Ct(O,D,!1,!1),b(L);var I=z(L,2),A=x(I,!0);b(I),ee(()=>ce(A,k())),f(h,S)},h=>{var S=H(),L=N(S);U(L,()=>k()&&j(),O=>{var I=on(),A=N(I);le(A,{get icon(){return j()}});var R=z(A,2),Y=x(R,!0);b(R),ee(()=>ce(Y,k())),f(O,I)},O=>{var I=H(),A=N(I);U(A,D,R=>{var Y=rn(),X=x(Y);Ct(X,D,!1,!1),b(Y),f(R,Y)},R=>{var Y=H(),X=N(Y);U(X,j,te=>{le(te,{get icon(){return j()}})},null,!0),f(R,Y)},!0),f(O,I)},!0),f(h,S)},!0),f(u,p)}),f(i,a)},i=>{var a=H(),_=N(a);U(_,()=>e.children,s=>{var u=H(),p=N(u);Me(p,()=>e.children),f(s,u)},s=>{var u=ln(),p=x(u,!0);b(u),ee(()=>ce(p,k())),f(s,u)},!0),f(i,a)}),b($),ee(()=>{$e($,"id",c()),$e($,"aria-label",v()),$e($,"style",E()),$.disabled=w(),ge($,"primo",M()==="primo"),ge($,"active",C()),ge($,"has-subbuttons",P()),ge($,"has-icon-button",!k()&&j())}),f(n,$),me()}We(["click"]);var _n=T('<span class="letter svelte-1pg8fna"><span class="inner-letter svelte-1pg8fna"> </span></span>');function un(n,e){let r=K(e,"letter",3,"b");var o=_n(),l=x(o),c=x(l,!0);b(l),b(o),ee(()=>ce(c,r())),f(n,o)}function st(){const{current:n}=Se(Xe);n==null||n.undoing(n.data),Xe.undo()}function ot(){const{data:n,doing:e}=Xe.redo();e(n)}var vn=T(`<div style="
						font-size: 0.75rem;
						padding-inline: 9px;
						display: flex;
						gap: 4px;
						justify-content: space-around;
					border: 1px solid var(--color-gray-8);
					color: white;
					height: 100%;
					align-items: center;
					border-radius: var(--primo-border-radius);"><div>&#8984; ↑</div> <div>&#8984; ↓</div></div>`),pn=T('<span class="page svelte-qggdaw"> <button> </button></span>'),gn=T('<span class="page svelte-qggdaw"> </span> <a class="page-type-badge svelte-qggdaw"><!></a>',1),fn=T('<span class="page-type svelte-qggdaw"><!> <span> </span></span>'),mn=T('<span class="page svelte-qggdaw"> </span>'),bn=T('<div class="editor"><!></div>'),yn=T('<div class="active-editors" style="display: flex; gap: 0.25rem"></div>'),hn=T('<div class="button-group svelte-qggdaw"></div>'),wn=T('<nav aria-label="toolbar" id="primo-toolbar" class="primo-reset svelte-qggdaw"><div class="menu-container svelte-qggdaw"><div class="left svelte-qggdaw"><!> <div class="button-group svelte-qggdaw"><!></div> <div class="button-group svelte-qggdaw"><!> <!></div></div> <div class="site-name svelte-qggdaw"><span class="site svelte-qggdaw"> </span> <!></div> <div class="right svelte-qggdaw"><!> <!> <!> <!> <!> <!></div></div></nav>');function xn(n,e){fe(e,!0);const r=xe(),o=()=>J(tt,"$site",r),l=()=>J(vt,"$page",r),c=()=>J(oa,"$pages",r),v=()=>J(lt,"$active_page",r),k=()=>J(ra,"$page_types",r),B=()=>J(Le,"$mod_key_held",r),j=()=>J(Lt,"$active_users",r),D=()=>J(Xe,"$timeline",r),w=()=>J(Qe,"$userRole",r),m=Je();let y=oe(void 0);Q(y,re(qt("DEBUGGING")));let C=oe(!1);he.on("up",()=>{Q(C,!0),t(M)&&Fe(`/${o().id}/${t(M).slug}`),setTimeout(()=>{Q(C,!1)},600)});let P=oe(!1);he.on("down",()=>{Q(P,!0),t(E)&&Fe(`/${o().id}/${t(E).slug}`),setTimeout(()=>{Q(P,!1)},600)});let M=V(()=>l().data.page?c().find(G=>G.parent===v().parent&&G.index===l().data.page.index-1):k().find(G=>G.index===l().data.page_type.index-1)),E=V(()=>l().data.page?c().find(G=>G.parent===v().parent&&G.index===l().data.page.index+1):k().find(G=>G.index===l().data.page_type.index+1));var q=wn(),$=x(q),g=x($),i=x(g);Za(i);var a=z(i,2),_=x(a);U(_,B,G=>{var F=vn(),ne=x(F),W=z(ne,2);b(F),ee(()=>{Be(ne,"color",t(C)?"var(--primo-color-brand)":"inherit"),Be(ne,"opacity",t(M)?"1":"0.1"),Be(W,"color",t(P)?"var(--primo-color-brand)":"inherit"),Be(W,"opacity",t(E)?"1":"0.1")}),f(G,F)},G=>{Pe(G,{label:"Pages",icon:"iconoir:multiple-pages",$$events:{click:()=>pe.show("SITE_PAGES",{},{hideLocaleSelector:!0,maxWidth:"1200px",showSwitch:!1})}})}),b(a);var s=z(a,2),u=x(s);Pe(u,{icon:"gg:website",$$events:{click:()=>pe.show("SITE_EDITOR",{},{showSwitch:!0,disabledBgClose:!0})}});var p=z(u,2);ze(p,17,()=>e.primary_buttons,He,(G,F)=>{Pe(G,{get icon(){return t(F).icon},$$events:{click(...ne){var W;(W=t(F).onclick)==null||W.apply(this,ne)}}})}),b(s),b(g);var d=z(g,2),h=x(d),S=x(h);b(h);var L=z(h,2);U(L,()=>t(y),G=>{var F=pn(),ne=x(F),W=z(ne),ie=x(W);b(W),b(F),ee(()=>{ce(ne,`${v().name??""} `),ce(ie,`(${v().id??""})`)}),ut(W,de=>jt(de)),f(G,F)},G=>{var F=H(),ne=N(F);U(ne,()=>l().data.page,W=>{var ie=gn(),de=N(ie),Z=x(de,!0);b(de);var se=z(de,2),ue=x(se);le(ue,{get icon(){return v().page_type.icon}}),b(se),ee(()=>{var ke,ve;ce(Z,v().name),$e(se,"style",`background-color: ${((ke=v().page_type)==null?void 0:ke.color)??""};`),$e(se,"href",`/${o().id??""}/page-type--${((ve=v().page_type)==null?void 0:ve.id)??""}`)}),f(W,ie)},W=>{var ie=H(),de=N(ie);U(de,()=>l().data.page_type,Z=>{var se=fn(),ue=x(se);le(ue,{get icon(){return l().data.page_type.icon}});var ke=z(ue,2),ve=x(ke,!0);b(ke),b(se),ee(()=>{Be(se,"background",l().data.page_type.color),ce(ve,l().data.page_type.name)}),f(Z,se)},Z=>{var se=mn(),ue=x(se,!0);b(se),ee(()=>ce(ue,v().name)),f(Z,se)},!0),f(W,ie)},!0),f(G,F)}),b(d);var O=z(d,2),I=x(O);U(I,()=>j().length>0,G=>{var F=yn();ze(F,5,j,He,(ne,W)=>{var ie=bn(),de=x(ie),Z=V(()=>t(W).email.slice(0,1));un(de,{get letter(){return t(Z)}}),b(ie),Kt(3,ie,()=>Nt,()=>({duration:200})),f(ne,ie)}),b(F),f(G,F)});var A=z(I,2);U(A,()=>!D().first,G=>{Pe(G,{id:"undo",title:"Undo",icon:"material-symbols:undo",style:"border: 0; font-size: 1.5rem;",$$events:{click(...F){st==null||st.apply(this,F)}}})});var R=z(A,2);U(R,()=>!D().last,G=>{Pe(G,{id:"redo",title:"Redo",icon:"material-symbols:redo",style:"border: 0; font-size: 1.5rem;",$$events:{click(...F){ot==null||ot.apply(this,F)}}})});var Y=z(R,2);U(Y,()=>w()==="DEV",G=>{var F=hn();ze(F,21,()=>e.secondary_buttons,He,(ne,W)=>{Pe(ne,{get icon(){return t(W).icon},$$events:{click(...ie){var de;(de=t(W).onclick)==null||de.apply(this,ie)}}})}),b(F),f(G,F)});var X=z(Y,2);Me(X,()=>e.children??Ke);var te=z(X,2);Pe(te,{type:"primo",icon:"entypo:publish",label:"Publish",active:!1,disabled:!1,$$events:{click:()=>m("publish")}}),b(O),b($),b(q),ee(()=>ce(S,`${o().name??""} /`)),f(n,q),me()}var kn=T('<div id="primo-modal" class="primo-modal modal mousetrap primo-reset svelte-57cznw"><div class="modal-background svelte-57cznw"></div> <div class="modal-card svelte-57cznw"><div class="modal-card-body svelte-57cznw"><!></div> <!></div></div>');function $n(n,e){fe(e,!0);const r=xe(),o=()=>J(pe,"$modal",r);var l=H(),c=N(l);U(c,()=>e.visible,v=>{var k=kn(),B=x(k),j=V(()=>o().disabledBgClose?()=>{}:()=>pe.hide());B.__click=function(...C){var P;(P=t(j))==null||P.apply(this,C)};var D=z(B,2),w=x(D),m=x(w);Me(m,()=>e.children??Ke),b(w);var y=z(w,2);U(y,()=>o().footer,C=>{var P=H();const M=V(()=>o().footer);var E=N(P);Ee(E,()=>t(M),(q,$)=>{$(q,{})}),f(C,P)}),b(D),b(k),ee(()=>{ge(B,"hovered",!o().disabledBgClose),Be(D,"max-width",o().maxWidth)}),Kt(3,k,()=>Nt,()=>({duration:100})),f(v,k)}),f(n,l),me()}We(["click"]);function En(n,e){const r=Ze(e,["children","$$slots","$$events","$$legacy"]),o=Ze(r,["id","toggled","disabled"]);fe(e,!1);const l=mt(),c=mt();let v=K(e,"id",24,()=>"toggle"+Math.random().toString(36)),k=K(e,"toggled",8,!0),B=K(e,"disabled",8,!1);rt(()=>qe(v()),()=>{Q(l,{for:v()})}),rt(()=>(qe(o),qe(v()),qe(B()),qe(k())),()=>{Q(c,{...o,id:v(),disabled:B(),"aria-checked":k(),type:"button",role:"switch"})}),Bt(),Jt();var j=H(),D=N(j);At(D,e,"default",{get label(){return t(l)},get button(){return t(c)}},null),f(n,j),me()}var Sn=T('<span class="svelte-8jq8hp"> </span>'),Dn=T('<label> </label> <div class="svelte-8jq8hp"><button></button> <!></div>',1);function Cn(n,e){const r=Ze(e,["children","$$slots","$$events","$$legacy"]),o=Ze(r,["toggled","label","hideLabel","small","disabled","on","off","switchColor","toggledColor","untoggledColor"]);fe(e,!1);let l=K(e,"toggled",12,!0),c=K(e,"label",8,"Label"),v=K(e,"hideLabel",8,!1),k=K(e,"small",8,!1),B=K(e,"disabled",8,!1),j=K(e,"on",8,void 0),D=K(e,"off",8,void 0),w=K(e,"switchColor",8,"#fff"),m=K(e,"toggledColor",8,"#0f62fe"),y=K(e,"untoggledColor",8,"#8d8d8d");const C=Je();rt(()=>qe(l()),()=>{C("toggle",l())}),Bt(),Jt(),En(n,{get toggled(){return l()},set toggled(P){l(P)},children:aa,$$slots:{default:(P,M)=>{const E=bt(()=>M.label),q=bt(()=>M.button);var $=Dn(),g=N($);let i;var a=x(g,!0);b(g);var _=z(g,2),s=x(_);let u;var p=z(s,2);At(p,e,"default",{get toggled(){return l()}},d=>{var h=H(),S=N(h);U(S,()=>j()&&D(),L=>{var O=Sn(),I=x(O,!0);b(O),ee(()=>ce(I,l()?j():D())),f(L,O)}),f(d,h)}),b(_),ee(()=>{i=Pt(g,i,{...t(E)},"svelte-8jq8hp"),ge(g,"hideLabel",v()),ce(a,c()),u=Pt(s,u,{...o,...t(q),style:`color: ${w()??""}; background-color: ${(l()?m():y())??""};
      ${o.style??""}`,disabled:B()},"svelte-8jq8hp"),ge(s,"small",k())}),Ie("click",s,function(d){Oe.call(this,e,d)}),Ie("click",s,()=>l(!l())),Ie("focus",s,function(d){Oe.call(this,e,d)}),Ie("blur",s,function(d){Oe.call(this,e,d)}),f(P,$)}},$$legacy:!0}),me()}var Pn=(n,e,r)=>{n.code==="Enter"&&(n.preventDefault(),n.target.blur(),e("rename",n.target.textContent),Q(r,!1))},On=T('<div contenteditable="" class="name svelte-1hhrrx6"> </div>'),Rn=T('<div class="name svelte-1hhrrx6"><h3 class="svelte-1hhrrx6"> </h3> <!></div>'),Tn=T('<div class="symbol-options svelte-1hhrrx6"><!> <!></div>'),qn=T('<div class="error svelte-1hhrrx6"><!></div>'),Bn=T('<div class="symbol"><!></div>'),In=T('<div class="sidebar-symbol svelte-1hhrrx6"><header class="svelte-1hhrrx6"><!> <!></header> <div class="symbol-container svelte-1hhrrx6"><!></div></div>');function Ht(n,e){fe(e,!0);const r=xe(),o=()=>J(zt,"$locale",r),l=()=>J(Qe,"$userRole",r),c=Je();let v=K(e,"symbol",15),k=K(e,"controls_enabled",3,!0),B=K(e,"show_toggle",3,!1),j=K(e,"toggled",3,!1),D=K(e,"head",3,""),w=K(e,"append",3,""),m=oe(void 0),y=oe(!1);async function C(){Q(y,!t(y)),v().name===""&&v(v().name="Block",!0)}let P=oe(0),M=oe(void 0),E={},q=oe(void 0);async function $(d,h){var I;if(ae.isEqual(E.code,d.code)&&ae.isEqual(E.entries,d.entries))return;const S={html:d.code.html,css:d.code.css,js:d.code.js},L=ca({entries:d.entries,fields:d.fields})[o()],O=await Ve.post("/api/render",{id:d.id,code:S,data:L,dev_mode:!1}).catch(A=>console.error(A));if((I=O==null?void 0:O.data)!=null&&I.error)Q(q,re(O.data.error));else if(O!=null&&O.data){const A=O.data;ae.isEqual(t(M),A)||(Q(M,re(A)),E=ae.cloneDeep({code:d.code,entries:d.entries})),Q(q,null)}else{const R=await _a({code:S,data:L});ae.isEqual(t(M),R)||(Q(M,re(R)),E=ae.cloneDeep({code:d.code,entries:d.entries}))}}let g=oe(void 0);Ae(()=>{Ya({element:t(g),getInitialData:()=>({block:v()})})}),Ae(()=>{if(t(m)){const d=document.createRange(),h=window.getSelection();d.setStart(t(m),1),d.collapse(!0),h==null||h.removeAllRanges(),h==null||h.addRange(d)}}),Ae(()=>{$(v(),o())});var i=In(),a=x(i),_=x(a);U(_,()=>t(y),d=>{var h=On();yt(h,L=>Q(m,L),()=>t(m)),Va(h,!0),h.__keydown=[Pn,c,y];var S=x(h,!0);b(h),ee(()=>ce(S,v().name)),Ie("blur",h,C),f(d,h)},d=>{var h=Rn(),S=x(h),L=x(S,!0);b(S);var O=z(S,2);U(O,k,I=>{}),b(h),ee(()=>ce(L,v().name)),f(d,h)});var s=z(_,2);U(s,k,d=>{var h=Tn(),S=x(h);U(S,B,I=>{Cn(I,{label:"Toggle Symbol for Page Type",get disabled(){return t(q)},hideLabel:!0,get toggled(){return j()},small:!0,$$events:{toggle(A){Oe.call(this,e,A)}}})});var L=z(S,2),O=V(()=>[...qt("DEBUGGING")?[{label:`${v().id.slice(0,5)}...`,icon:"ph:copy-duotone",on_click:I=>jt(I.target,v().id)}]:[],...l()==="DEV"?[{label:"Edit Block",icon:"material-symbols:code",on_click:()=>c("edit")},{label:"Duplicate",icon:"bxs:duplicate",on_click:()=>c("duplicate")}]:[],{label:"Rename",icon:"ic:baseline-edit",on_click:C},{label:"Download",icon:"ic:baseline-download",on_click:()=>c("download")},{label:"Delete",icon:"ic:outline-delete",is_danger:!0,on_click:()=>c("delete")}]);da(L,{icon:"carbon:overflow-menu-vertical",get options(){return t(O)}}),b(h),f(d,h)}),b(a);var u=z(a,2);yt(u,d=>Q(g,d),()=>t(g));var p=x(u);U(p,()=>t(q),d=>{var h=qn(),S=x(h);le(S,{icon:"heroicons:no-symbol-16-solid"}),b(h),f(d,h)},d=>{var h=H(),S=N(h);U(S,()=>t(M),L=>{var O=Bn(),I=x(O);Ga(I,()=>t(M),A=>{var R=V(()=>({...t(M),head:D()}));la(A,{get height(){return t(P)},set height(Y){Q(P,re(Y))},get append(){return w()},get componentCode(){return t(R)}})}),b(O),f(L,O)},null,!0),f(d,h)}),b(u),b(i),ee(()=>{$e(u,"data-test-id",`symbol-${v().id??""}`),ge(u,"disabled",t(q))}),f(n,i),me()}We(["keydown"]);var Ln=T('<div class="field-item"><!></div>'),jn=T('<div class="field-item"><!></div>'),An=T('<div class="field-item"><!></div>'),zn=T('<p class="empty-description svelte-1oexpfm">Field requires a key</p>'),Mn=T('<p class="empty-description svelte-1oexpfm"><!></p>'),Fn=T('<div class="Content svelte-1oexpfm"></div>');function Xt(n,e){fe(e,!0);const r=xe(),o=()=>J(va,"$fieldTypes",r),l=()=>J(zt,"$locale",r),c=()=>J(lt,"$active_page",r),v=()=>J(Qe,"$userRole",r);let k=K(e,"changes",19,()=>[]),B=K(e,"minimal",3,!1);const j=Je();function D(i){const a=e.entries.find(_=>_.id===i.parent);return a?[a.id,...D(a)]:[]}function w(i){const a=fa(o(),["id",i.type]);return a?a.component:(console.warn(`Field type '${i.type}' no longer exists, removing '${i.label}' field`),null)}function m(i){if(!i.options.condition)return!0;const{field:a,value:_,comparison:s}=i.options.condition;if(!e.fields.find(d=>d.id===a))return i.options.condition=null,!1;const{value:p}=e.entries.find(d=>d.field===a);if(pa(_)){const d=new RegExp(_.slice(1,-1));if(s==="="&&d.test(p))return!0;if(s==="!="&&!d.test(p))return!0}else{if(s==="="&&_===p)return!0;if(s==="!="&&_!==p)return!0}return!1}function y({parent:i,index:a,subfields:_}){const s=e.entries.find(S=>S.id===i),u=ht({parent:s.id,index:a}),p=_.map(S=>ht({parent:u.id,field:S.id,value:ga(S),locale:S.type==="repeater"||S.type==="group"?null:l()})),d=[u,...p],h=Ge([...e.entries,...d]);E({entries:h,changes:d.map(S=>({action:"insert",id:S.id,data:S}))})}function C(i){let a=Ge(e.entries.filter(s=>s.id!==i.id));const _=a.filter(s=>s.parent===i.parent).sort((s,u)=>s.index-u.index).map((s,u)=>({...s,index:u}));for(const s of _){const u=a.find(p=>p.id===s.id);u.index=s.index}a=a.filter(s=>!D(s).includes(i.id)),E({entries:a,changes:[{action:"delete",id:i.id}]})}function P({item:i,direction:a}){const _=Ge(e.entries),s=_.filter(p=>p.parent===i.parent&&p.id!==i.id).sort((p,d)=>p.index-d.index),u={up:[...s.slice(0,i.index-1),i,...s.slice(i.index-1)],down:[...s.slice(0,i.index+1),i,...s.slice(i.index+1)]}[a].map((p,d)=>({...p,index:d}));for(const p of u){const d=_.find(h=>h.id===p.id);d.index=p.index}E({entries:_,changes:u.map(p=>({action:"update",id:p.id,data:{index:p.index}}))})}function M(i=[]){let a=ae.cloneDeep(k());if(i.length===0)return a;for(const _ of i){const{action:s,id:u,data:p}=_,d=a.find(L=>L.id===_.id);if(!d){a=[...a,{action:s,id:u,data:p}];continue}const{action:h,data:S}=d;if(s==="update"&&h==="insert"){d.data={...S,...p};continue}if(s==="update"){d.data={...S,...p};continue}s==="delete"&&(a=a.filter(L=>{if(L.id===_.id)return!1;const O=e.entries.find(I=>I.id===L.id);return!D(O).includes(_.id)}))}return a}function E(i){j("input",{entries:ae.cloneDeep(i.entries),changes:M(i.changes)})}async function q(i){const[a]=await Re({table:"entries",action:"select",match:{field:i.source,page:c().id}}),_=e.entries.find(s=>s.field===i.id);return a?{..._,value:a.value}:_}function $(i){return i.source?c().page_type.fields.some(a=>a.id===i.source):!0}var g=Fn();ze(g,21,()=>e.fields.filter(i=>!i.parent).sort((i,a)=>i.index-a.index),He,(i,a)=>{var _=H();const s=V(()=>e.entries.find(L=>L.field===t(a).id)),u=V(()=>w(t(a))),p=V(()=>m(t(a))&&$(t(a))),d=V(()=>(t(a).key||t(a).type==="info")&&t(u)),h=V(()=>t(a).type==="repeater"||t(a).type==="group");var S=N(_);U(S,()=>t(a).source&&t(d)&&t(p),L=>{var O=H(),I=N(O);ua(I,()=>q(t(a)),A=>{var R=V(()=>t(h)?t(a).label:null),Y=V(()=>{var X;return(X=o().find(te=>te.id===t(a).type))==null?void 0:X.icon});at(A,{get title(){return t(R)},get icon(){return t(Y)},children:(X,te)=>{var G=jn(),F=x(G);le(F,{icon:"line-md:loading-twotone-loop"}),b(G),ee(()=>$e(G,"id",`field-${t(a).key??""}`)),f(X,G)},$$slots:{default:!0}})},(A,R)=>{var Y=V(()=>t(h)?t(a).label:null),X=V(()=>{var te;return(te=o().find(G=>G.id===t(a).type))==null?void 0:te.icon});at(A,{get title(){return t(Y)},get icon(){return t(X)},children:(te,G)=>{var F=Ln(),ne=x(F),W=V(()=>({...t(a),label:`${t(a).label} (PAGE FIELD)`}));Ee(ne,()=>t(u),(ie,de)=>{de(ie,{get id(){return t(R).id},get value(){return t(R).value},get entries(){return e.entries},get field(){return t(W)},get fields(){return e.fields},disabled:!0,oninput:Z=>{const se=Z.id||t(R).id,ue=Z.data||Z,ke=e.entries.map(ve=>ve.id===se?{...ve,...ue}:ve);E({entries:ke,changes:[{action:"update",id:se,data:ue}]})},$$events:{keydown(Z){Oe.call(this,e,Z)}}})}),b(F),ee(()=>{$e(F,"id",`field-${t(a).key??""}`),ge(F,"repeater",t(a).key==="repeater")}),f(te,F)},$$slots:{default:!0}})}),f(L,O)},L=>{var O=H(),I=N(O);U(I,()=>t(d)&&t(p),A=>{var R=V(()=>t(h)?t(a).label:null),Y=V(()=>{var te;return(te=o().find(G=>G.id===t(a).type))==null?void 0:te.icon}),X=V(()=>t(a).is_static?"Static":null);at(A,{get title(){return t(R)},get icon(){return t(Y)},get pill(){return t(X)},get minimal(){return B()},children:(te,G)=>{var F=An(),ne=x(F),W=V(()=>t(s).value==="");Ee(ne,()=>t(u),(ie,de)=>{de(ie,{get id(){return t(s).id},get value(){return t(s).value},get entries(){return e.entries},get field(){return t(a)},get fields(){return e.fields},get autocomplete(){return t(W)},oninput:Z=>{const se=Z.id||t(s).id,ue=Z.data||Z,ke=e.entries.map(ve=>ve.id===se?{...ve,...ue}:ve);E({entries:ke,changes:[{action:"update",id:se,data:ue}]})},$$events:{keydown(Z){Oe.call(this,e,Z)},add:({detail:Z})=>y(Z),remove:({detail:Z})=>C(Z),move:({detail:Z})=>P(Z)}})}),b(F),ee(()=>{$e(F,"id",`field-${t(a).key??""}`),ge(F,"repeater",t(a).key==="repeater")}),f(te,F)},$$slots:{default:!0}})},A=>{var R=H(),Y=N(R);U(Y,()=>t(p),X=>{var te=zn();f(X,te)},null,!0),f(A,R)},!0),f(L,O)}),f(i,_)},i=>{var a=Mn(),_=x(a);U(_,()=>v()==="DEV",s=>{var u=ft("When you create fields, they'll be editable from here");f(s,u)},s=>{var u=ft("When the site developer creates fields, they'll be editable from here");f(s,u)}),b(a),f(i,a)}),b(g),f(n,g),me()}async function dt({symbol:n,changes:e,index:r}){let o;await Ue({doing:async()=>{const l=await Zt({name:n.name,code:n.code,entries:n.entries.filter(c=>!c.page&&!c.site),fields:n.fields,index:r,insertions:e});o=l.id,await ea(l)},undoing:async()=>{await pt(o)}})}async function Un(n){let e=n.id;await Ue({doing:async()=>{await pt(e),wt()},undoing:async()=>{const r=await Zt({name:n.name,code:n.code,index:n.index,entries:n.entries,fields:n.fields,insertions:{entries:n.entries.map(o=>({action:"insert",id:o.id,data:o})),fields:n.fields.map(o=>({action:"insert",id:o.id,data:o}))}});e=r.id,await ea(r),wt()}})}async function Gn(n){let e;await Ue({doing:async()=>{const r=n.map(c=>{const v=ct(),k=ma(c.entries,c.fields);return console.log({remapped:k}),{...c,index:0,id:v,entries:k.entries.map(B=>({...B,symbol:v})),fields:k.fields.map(B=>({...B,symbol:v}))}});_e.symbols.update(c=>[...c,...r]),await Re({table:"symbols",action:"insert",data:r.map(c=>ae.omit(c,["entries","fields"]))});const o=r.flatMap(c=>c.fields.map(v=>({...v,symbol:c.id}))),l=r.flatMap(c=>c.entries.map(v=>({...v,symbol:c.id})));await Re({table:"fields",action:"insert",data:o}),await Re({table:"entries",action:"insert",data:l})},undoing:async()=>{await pt(e)}})}async function Kn({block:n,updated_data:e,changes:r}){const o=n.code;let l=ae.cloneDeep(n.fields),c=ae.cloneDeep(n.entries);const v=e.code;let k=ae.cloneDeep(e.fields),B=ae.cloneDeep(e.entries.filter(y=>!y.site)),j=ae.cloneDeep(r.entries.filter(y=>!y.dynamic)),D=ae.cloneDeep(r.fields);const w=xt({symbol_id:n.id,field_changes:D,original_fields:l,updated_fields:k});let m=[];await Ue({doing:async()=>{ha({changes:{fields:D,entries:[...j,...w.flatMap(y=>y.changes)]},items:{fields:k,entries:[...B,...w.flatMap(y=>y.entries)]}}),je.update_symbol(n.id,{fields:k,entries:B,code:v});for(const{id:y,entries:C}of w)je.update_section(y,{entries:C});if(ae.isEqual(o,v)||await De.update_block(n.id,{code:v}),await kt(D,{symbol:n.id}),await Te(j,{symbol:n.id}),j.length>0){await Promise.all(w.map(({id:C,changes:P})=>Te(P,{section:C})));const y=await Ha(n.id);m=xt({symbol_id:n.id,field_changes:D,original_fields:l,updated_fields:k},y),await Promise.all(m.map(({id:C,changes:P})=>Te(P,{section:C})))}$t(Se(_e.symbols).find(y=>y.id===n.id))},undoing:async()=>{const{changes:y,fields:C,map:P}=wa(D,l),{changes:M,entries:E}=nt(j,c,P),q=w.map(({changes:g,entries:i})=>nt(g,i,P)),$=m.map(({changes:g,entries:i})=>nt(g,i,P));q.forEach((g,i)=>{const a=w[i].id;je.update_section(a,{entries:g})}),je.update_symbol(n.id,{fields:C,entries:E,code:o}),ae.isEqual(o,v)||De.update_block(n.id,{code:o}),await kt(y,{symbol:n.id}),await Promise.all([Te(M,{symbol:n.id}),...q.map((g,i)=>{const a=w[i].id;return Te(g.changes,{section:a})})]),M.length>0&&await Promise.all($.map(async({changes:g,entries:i},a)=>{const _=m[a].id,[s]=xa(g,i);await Te(s,{section:_})})),l=C,c=E,$t(Se(_e.symbols).find(g=>g.id===n.id))}})}async function Nn({block:n,name:e}){await Ue({doing:async()=>{je.update_symbol(n.id,{name:e}),De.update_block(n.id,{name:e})},undoing:async()=>{je.update_symbol(n.id,{name:e}),De.update_block(n.id,{name:n.name})}})}async function et(n,e){const r=Ge(Se(_e.symbols)),o=Ge(Se(_e.symbols)).filter(c=>c.id!==n.id),l=[...o.slice(0,e),n,...o.slice(e)].map((c,v)=>({...c,index:v}));await Ue({doing:async()=>{_e.symbols.set(l),await Promise.all([l.map(c=>De.update_block(c.id,{index:c.index}))])},undoing:async()=>{_e.symbols.set(r),await Promise.all([r.map(c=>De.update_block(c.id,{index:c.index}))])}})}async function Zt({name:n="New Block",code:e,entries:r,fields:o,index:l,insertions:c}){const v=await Re({table:"symbols",action:"insert",data:{name:n,code:e,index:l,site:Se(tt).id}}),k=await ba(c.fields,{symbol:v}),B=await ya(c.entries,k,{symbol:v});return Mt({id:v,name:n,code:e,index:l,entries:r.map(D=>({...D,id:B[D.id],parent:B[D.parent],field:k[D.field]})),fields:o.map(D=>({...D,id:k[D.id],parent:k[D.parent]}))})}async function ea(n){const e=ae.cloneDeep(Se(_e.symbols)),r=[...e.slice(0,n.index),n,...e.slice(n.index)].map((o,l)=>({...o,index:l}));_e.symbols.set(r),await Promise.all(r.map(o=>De.update_block(o.id,{index:o.index})))}async function pt(n){const r=ae.cloneDeep(Se(_e.symbols)).filter(o=>o.id!==n).map((o,l)=>({...o,index:l}));_e.symbols.set(r),await Re({table:"symbols",action:"delete",id:n}),await Promise.all(r.map(o=>De.update_block(o.id,{index:o.index})))}const De={update_block:async(n,e)=>{await Re({table:"symbols",action:"update",id:n,data:e})}},je={update_section:(n,e)=>{_e.sections.update(r=>r.map(o=>o.id===n?{...o,...e}:o))},update_symbol:(n,e)=>{_e.symbols.update(r=>r.map(o=>o.id===n?{...o,...e}:o))}};var Vn=T("<div><!></div>"),Wn=T('<div style="display: flex;justify-content: center;font-size: 2rem;"><!></div>'),Jn=(n,e,r)=>Fe(`/${e().id}/page-type--${r().page_type.id}?t=b`),Qn=T('<div class="symbols svelte-1q9b826"><!></div> <button class="footer-link svelte-1q9b826">Manage Blocks</button>',1),Yn=(n,e,r)=>Fe(`/${e().id}/page-type--${r().page_type.id}?t=p`),Hn=T('<div class="page-type-fields svelte-1q9b826"><!></div> <button class="footer-link svelte-1q9b826">Manage Fields</button>',1),Xn=T('<div class="sidebar primo-reset svelte-1q9b826"><!> <div class="container svelte-1q9b826"><!></div></div>');function Zn(n,e){fe(e,!0);const r=xe(),o=()=>J(Ut,"$symbols",r),l=()=>J(lt,"$active_page",r),c=()=>J(tt,"$site",r);let v=oe(re(localStorage.getItem("page-tab")||"BLOCKS")),k=V(()=>o().filter(q=>q.page_types.includes(l().page_type.id))),B=V(()=>t(k).length>0);Ae(()=>{t(B)?Q(v,"BLOCKS"):Q(v,"PROPERTIES")});function j(q,$){Wt({element:q,getData({input:g,element:i}){return Qt({block:$},{element:i,input:g,allowedEdges:["top","bottom"]})},onDragStart(){we(it,!0)},onDragEnd(){we(it,!1)},onDrop({self:g,source:i}){we(it,!1);const a=o().find(u=>u.id===g.data.block.id).index,_=i.data.block,s=Yt(g.data);s==="top"?et(_,a):s==="bottom"&&et(_,a+1)}})}let D=oe("");async function w(q){if(q.length===0)return"";const $=await ka({}),{data:g}=await Ve.post("/api/render",{code:{html:`<svelte:head>${q}</svelte:head>`,css:"",js:""},data:$,dev_mode:!1});Q(D,re(g.head))}Ae(()=>{w(l().page_type.code.head)});let m=oe(null);async function y(q){if(q.length===0)return"";const $=await $a({}),{data:g}=await Ve.post("/api/render",{code:{html:`<svelte:head>${q}</svelte:head>`,css:"",js:""},data:$,dev_mode:!1});Q(m,re(g.head))}Ae(()=>{y(c().code.head)});var C=Xn(),P=x(C);U(P,()=>t(B),q=>{var $=H(),g=N($);Ee(g,()=>Ne.Tabs,(i,a)=>{a(i,{variant:"secondary",tabs:[{id:"BLOCKS",icon:"lucide:blocks",label:"Blocks"},{id:"PROPERTIES",icon:"material-symbols:article-outline",label:"Properties"}],get active_tab_id(){return t(v)},set active_tab_id(_){Q(v,re(_))},disable_hotkeys:!0,$$events:{switch:({detail:_})=>{localStorage.setItem("page-tab",_)}}})}),f(q,$)});var M=z(P,2),E=x(M);U(E,()=>t(v)==="BLOCKS",q=>{var $=Qn(),g=N($),i=x(g);U(i,()=>t(m)!==null,_=>{var s=H(),u=N(s);ze(u,27,()=>t(k),p=>p.id,(p,d)=>{var h=Vn(),S=x(h),L=V(()=>t(m)+t(D)),O=V(()=>_t(c().design));Ht(S,{get symbol(){return t(d)},controls_enabled:!1,get head(){return t(L)},get append(){return t(O)}}),b(h),Vt(h,()=>Gt,()=>({duration:200})),ut(h,(I,A)=>j(I,A),()=>t(d)),f(p,h)}),f(_,s)},_=>{var s=Wn(),u=x(s);Ee(u,()=>Ne.Spinner,(p,d)=>{d(p,{variant:"loop"})}),b(s),f(_,s)}),b(g);var a=z(g,2);a.__click=[Jn,c,l],f(q,$)},q=>{var $=Hn(),g=N($),i=x(g),a=V(()=>Ft({instant:({detail:s})=>Et.store(s.entries),delay:({detail:s})=>Et.db(s)}));Xt(i,{get fields(){return l().page_type.fields},get entries(){return l().entries},minimal:!0,$$events:{input(...s){var u;(u=t(a))==null||u.apply(this,s)}}}),b(g);var _=z(g,2);_.__click=[Yn,c,l],f(q,$)}),b(M),b(C),f(n,C),me()}We(["click"]);function ei(n){if(!Array.isArray(n.entries)){const e=ta({fields:n.fields});return Mt({...n,entries:ti({content:n.content,all_fields:e}),fields:e})}return n}function ta({fields:n,parent_id:e=null,result:r=[],args:o={}}){return n.forEach((l,c)=>{const v={...Ea({...l,index:c}),...o,id:l.id,parent:e};r.push(v),l.default&&console.log("DEFAULT",l,v),l.fields.length>0&&ta({fields:l.fields,parent_id:l.id,result:r,args:o})}),r}function ti({content:n,all_fields:e,args:r={}}){const o=[];function l({value:v,locale:k,field:B,index:j=null,parent:D=null,args:w={}}){const m=ct();return o.push({id:m,value:v,locale:k,field:B,index:j,parent:D,...w}),m}function c({content_value:v,fields:k,locale:B,parent:j=null}){Object.keys(v).forEach(D=>{const w=v[D],m=k.find(y=>y.key===D);if(!m){console.log("NO FIELD FOUND",{content_value:v,item:w,field_key:D,fields:k});return}if(m.type==="group"){const y=l({value:null,locale:null,field:m.id,parent:j,args:r});c({content_value:w,locale:B,fields:e.filter(C=>C.parent===m.id),parent:y})}else if(m.type==="repeater"){const y=l({value:null,locale:null,field:m.id,parent:j,args:r});w.forEach((C,P)=>{const M=l({value:null,field:null,locale:null,index:P,parent:y,args:r});c({content_value:C,locale:B,fields:e.filter(E=>E.parent===m.id),parent:M})})}else l({value:w,field:m.id,locale:B,parent:j,args:r})})}return Object.keys(n).forEach(v=>{Sa.find(k=>k.key===v)&&c({content_value:n[v],locale:v,fields:e})}),o}async function Rt(){pe.show("BLOCK_EDITOR",{header:{title:"Create Block'}",icon:"fas fa-check",button:{label:"Save Block",icon:"fas fa-check",onclick:(n,e)=>{dt({symbol:n,changes:e,index:0}),pe.hide()}}},tab:"code"},{showSwitch:!0,disabledBgClose:!0})}async function Tt(n,e){pe.show("BLOCK_PICKER",{site:e(),append:_t(e().design),onsave:r=>{Gn(r),pe.hide()}},{hideLocaleSelector:!0})}var ai=T('<button class="primo-button svelte-u5xx8u"><!> <span>Create</span></button>'),ni=T('<div class="block svelte-u5xx8u"><!></div>'),ii=T('<div class="primo-buttons svelte-u5xx8u"><button class="primo-button svelte-u5xx8u"><!> <span>Add</span></button> <!> <label class="primo-button svelte-u5xx8u"><input type="file" accept=".json" class="svelte-u5xx8u"> <!> <span>Upload</span></label></div>  <div class="block-list svelte-u5xx8u"></div>',1),si=T('<div class="empty svelte-u5xx8u">Add a Block to your site to use it on your pages.</div> <div class="primo-buttons svelte-u5xx8u"><button class="primo-button svelte-u5xx8u"><!> <span>Add</span></button> <button class="primo-button svelte-u5xx8u"><!> <span>Create</span></button> <label class="primo-button svelte-u5xx8u"><input type="file" accept=".json" class="svelte-u5xx8u"> <!> <span>Upload</span></label></div>',1),oi=()=>pe.show("PAGE_EDITOR"),ri=T('<button class="primo--link" style="margin-bottom: 1rem"><!> <span>Edit Page Type</span></button>'),di=T('<div class="page-type-fields"><!> <!></div>'),li=T('<div class="sidebar primo-reset svelte-u5xx8u"><!> <div class="container svelte-u5xx8u"><!></div></div>');function ci(n,e){fe(e,!0);const r=xe(),o=()=>J(vt,"$page",r),l=()=>J(tt,"$site",r),c=()=>J(Ut,"$symbols",r),v=()=>J(Qe,"$userRole",r),k=()=>J(Da,"$page_type",r);let B=oe(re(o().url.searchParams.get("t")==="p"?"PROPERTIES":"BLOCKS"));{const g=new URL(o().url);g.searchParams.delete("t"),Fe(g,{replaceState:!0})}function j(g){pe.show("BLOCK_EDITOR",{block:g,header:{title:`Edit ${g.title||"Block"}`,icon:"fas fa-check",button:{label:"Save Block",icon:"fas fa-check",onclick:(i,a)=>{pe.hide(),Kn({block:g,updated_data:i,changes:a})}}},tab:"code"},{showSwitch:!0,disabledBgClose:!0})}async function D(g){Un(g)}async function w(g,i){const a=c().find(s=>s.id===g),_=ae.cloneDeep(a);_.id=ct(),delete _.created_at,_.name=`${_.name} (copy)`,dt({symbol:_,changes:{fields:_.fields.map(s=>({action:"insert",id:s.id,data:s})),entries:_.entries.map(s=>({action:"insert",id:s.id,data:s}))},index:i})}async function m({target:g}){var i=new window.FileReader;i.onload=async function({target:a}){if(typeof a.result=="string")try{const _=JSON.parse(a.result),s=ei(_);dt({symbol:s,changes:{entries:s.entries.map(u=>({action:"insert",data:u,id:u.id})),fields:s.fields.map(u=>({action:"insert",data:u,id:u.id}))},index:0})}catch(_){console.error(_)}},i.readAsText(g.files[0])}async function y(g){const i=c().find(s=>s.id===g),a=JSON.stringify(i);var _=new Blob([a],{type:"application/json"});Wa.saveAs(_,`${i.name||i.id}.json`)}let C=oe(null);function P(g,i){Wt({element:g,getData({input:a,element:_}){return Qt({block:i},{element:_,input:a,allowedEdges:["top","bottom"]})},onDrag({self:a,source:_}){},onDragLeave(){},onDrop({self:a,source:_}){const s=c().find(d=>d.id===a.data.block.id).index,u=_.data.block,p=Yt(a.data);p==="top"?et(u,s):p==="bottom"&&et(u,s+1)}})}var M=li(),E=x(M);Ee(E,()=>Ne.Tabs,(g,i)=>{i(g,{variant:"secondary",tabs:[{id:"BLOCKS",icon:"lucide:blocks",label:"Blocks"},{id:"PROPERTIES",icon:"material-symbols:article-outline",label:"Properties"}],get active_tab_id(){return t(B)},set active_tab_id(a){Q(B,re(a))},disable_hotkeys:!0})});var q=z(E,2),$=x(q);U($,()=>t(B)==="BLOCKS",g=>{var i=H(),a=N(i);U(a,()=>c().length>0,_=>{var s=ii(),u=N(s),p=x(u);p.__click=[Tt,l];var d=x(p);le(d,{icon:"mdi:plus"}),Ce(2),b(p);var h=z(p,2);U(h,()=>v()==="DEV",A=>{var R=ai();R.__click=[Rt];var Y=x(R);le(Y,{icon:"mdi:code"}),Ce(2),b(R),f(A,R)});var S=z(h,2),L=x(S);L.__change=m;var O=z(L,2);le(O,{icon:"mdi:upload"}),Ce(2),b(S),b(u);var I=z(u,2);ze(I,15,()=>c().sort((A,R)=>A.index-R.index),A=>A.id,(A,R,Y)=>{var X=ni();const te=V(()=>{var W;return(W=t(R).page_types)==null?void 0:W.includes(k().id)});var G=x(X),F=V(()=>l().code.head+k().code.head),ne=V(()=>_t(l().design));Ht(G,{get symbol(){return t(R)},get head(){return t(F)},get append(){return t(ne)},show_toggle:!0,get toggled(){return t(te)},onmousedown:()=>Q(C,re(t(R)._drag_id)),onmouseup:()=>Q(C,null),$$events:{toggle:({detail:W})=>{W!==t(te)&&Ca({symbol_id:t(R).id,page_type_id:k().id,toggled:W})},edit:()=>j(t(R)),rename:({detail:W})=>Nn({block:t(R),name:W}),download:()=>y(t(R).id),delete:()=>D(t(R)),duplicate:()=>w(t(R).id,t(Y)+1)}}),b(X),Vt(X,()=>Gt,()=>({duration:200})),ut(X,(W,ie)=>P(W,ie),()=>t(R)),f(A,X)}),b(I),f(_,s)},_=>{var s=si(),u=z(N(s),2),p=x(u);p.__click=[Tt,l];var d=x(p);le(d,{icon:"mdi:plus"}),Ce(2),b(p);var h=z(p,2);h.__click=[Rt];var S=x(h);le(S,{icon:"mdi:code"}),Ce(2),b(h);var L=z(h,2),O=x(L);O.__change=m;var I=z(O,2);le(I,{icon:"mdi:upload"}),Ce(2),b(L),b(u),f(_,s)}),f(g,i)},g=>{var i=di(),a=x(i);U(a,()=>v()==="DEV",u=>{var p=ri();p.__click=[oi];var d=x(p);le(d,{icon:"mdi:code"}),Ce(2),b(p),f(u,p)});var _=z(a,2),s=V(()=>Ft({instant:({detail:u})=>St.store(u),delay:({detail:u})=>St.db(u)}));Xt(_,{get fields(){return k().fields},get entries(){return k().entries},minimal:!0,$$events:{input(...u){var p;(p=t(s))==null||p.apply(this,u)}}}),b(i),f(g,i)}),b(q),b(M),f(n,M),me()}We(["click","change"]);var _i=T('<div class="expand primo-reset svelte-1t6d9gl"><!></div>'),ui=T('<span class="grab-handle svelte-1t6d9gl"><!></span>'),vi=T("<!> <!> <!>",1),pi=T("<!> <!> <!>",1);function gi(n,e){fe(e,!0);const r=xe(),o=()=>J(pe,"$modal",r),l=()=>J(Le,"$mod_key_held",r),c=()=>J(Ta,"$onMobile",r);let v=K(e,"role",3,"DEV"),k=K(e,"primary_buttons",19,()=>[]),B=K(e,"dropdown",19,()=>[]),j=K(e,"secondary_buttons",19,()=>[]),D=K(e,"primo_symbols",19,()=>[]);Ot(e.data);function w(i){return i?{SITE_PAGES:qa,SECTION_EDITOR:Ba,BLOCK_EDITOR:Ia,SITE_EDITOR:La}[i]||o().component:null}let m=oe(!0);function y(){Q(m,!0),t(C).resize(20)}Ka(["mdi:icon","bxs:duplicate","ic:baseline-edit","ic:baseline-download","ic:outline-delete","bsx:error","mdi:plus","mdi:upload","fa-solid:plus","carbon:close","material-symbols:drag-handle-rounded","ph:caret-down-bold","ph:caret-up-bold","charm:layout-rows","charm:layout-columns","bx:refresh","uil:image-upload","mdi:arrow-up","mdi:arrow-down","ion:trash","akar-icons:plus","akar-icons:check","mdi:chevron-down","ic:round-code","eos-icons:loading","material-symbols:code","fluent:form-multiple-24-regular"]),Na("local");{let i=function(a){!a.metaKey&&l()&&we(Le,!1)};be.bind("mod",()=>we(Le,!0),"keydown"),be.bind("mod",()=>we(Le,!1),"keyup"),window.addEventListener("mousemove",ae.throttle(i,100)),be.bind(["mod+1"],a=>{a.preventDefault(),he.dispatch("tab-switch",1)}),be.bind(["mod+2"],a=>{a.preventDefault(),he.dispatch("tab-switch",2)}),be.bind(["mod+3"],a=>{a.preventDefault(),he.dispatch("tab-switch",3)}),be.bind("escape",a=>{he.dispatch("escape")}),be.bind("mod+s",a=>{a.preventDefault(),he.dispatch("save")}),be.bind("mod+up",a=>{a.preventDefault(),he.dispatch("up")}),be.bind("mod+down",a=>{a.preventDefault(),he.dispatch("down")}),be.bind("mod+e",a=>{console.log("dispatching e"),a.preventDefault(),he.dispatch("e")})}let C=oe(void 0);It(()=>{we(Qe,re(v())),we(en,re(D())),Ot(e.data)});let P=V(()=>w(o().type));var M=pi();Ie("resize",na,y);var E=N(M);xn(E,{get primary_buttons(){return k()},get dropdown(){return B()},get secondary_buttons(){return j()},$$events:{publish(i){Oe.call(this,e,i)}},children:(i,a)=>{var _=H(),s=N(_);Me(s,()=>e.toolbar??Ke),f(i,_)},$$slots:{default:!0}});var q=z(E,2);Pa(q,{direction:"horizontal",style:`display: flex;     
		height: 100vh`,autoSaveId:"page-view",children:(i,a)=>{var _=vi(),s=N(_);Dt(s,{style:"padding-top: 42px;",get pane(){return t(C)},set pane(d){Q(C,re(d))},defaultSize:20,minSize:2,onResize:d=>{d<10?(Q(m,!1),t(C).resize(2)):Q(m,!0)},children:(d,h)=>{var S=H(),L=N(S);U(L,()=>t(m),O=>{var I=H(),A=N(I);U(A,()=>e.data.page_type,R=>{ci(R,{})},R=>{Zn(R,{})}),f(O,I)},O=>{var I=H(),A=N(I);U(A,()=>!c(),R=>{var Y=_i(),X=x(Y);Oa(X,{onclick:y,icon:"tabler:layout-sidebar-left-expand"}),b(Y),f(R,Y)},null,!0),f(O,I)}),f(d,S)},$$slots:{default:!0}});var u=z(s,2);Ra(u,{class:"PaneResizer",style:`display: flex;
		align-items: center;
		justify-content: center;`,children:(d,h)=>{var S=H(),L=N(S);U(L,()=>t(m),O=>{var I=ui(),A=x(I);le(A,{icon:"octicon:grabber-16"}),b(I),f(O,I)}),f(d,S)},$$slots:{default:!0}});var p=z(u,2);Dt(p,{style:"position: relative;",defaultSize:80,children:(d,h)=>{var S=H(),L=N(S);Me(L,()=>e.children??Ke),f(d,S)},$$slots:{default:!0}}),f(i,_)},$$slots:{default:!0}});var $=z(q,2),g=V(()=>!!t(P));$n($,{get visible(){return t(g)},children:(i,a)=>{var _=H();const s=V(()=>t(P));var u=N(_);Ee(u,()=>t(s),(p,d)=>{d(p,Ua(()=>o().componentProps))}),f(i,_)},$$slots:{default:!0}}),f(n,M),me()}function Li(n,e){fe(e,!0);const r=xe(),o=()=>J(vt,"$page",r);Aa(async({table:w,action:m,data:y,id:C,match:P,order:M})=>{var q;console.log({table:w,action:m,data:y,id:C,match:P,order:M});let E;if(m==="insert"?Array.isArray(y)?E=await ye.from(w).insert(y).select("id"):E=await ye.from(w).insert(y).select("id").single():m==="update"?C?E=await ye.from(w).update(y).eq("id",C).select("id").single():P&&(E=await ye.from(w).update(y).match(P).select("id").single()):m==="delete"?C?E=await ye.from(w).delete().eq("id",C).select():P&&(E=await ye.from(w).delete().match(P).select()):m==="upsert"?E=await ye.from(w).upsert(y):m==="select"&&(M?E=await ye.from(w).select(y).match(P).order(...M):E=await ye.from(w).select(y).match(P)),E!=null&&E.error)return console.error({error:E.error,args:{table:w,action:m,data:y,id:C,match:P,order:M}}),null;if(E!=null&&E.data&&Array.isArray(E.data))return E.data;if(E!=null&&E.data)return(q=E.data)==null?void 0:q.id}),za(async({action:w,key:m,file:y,options:C})=>{if(console.log({key:m,action:w,file:y}),w==="upload"){const{data:P}=await Ve.get(`/api/uploads/get-signed-url?site_id=${o().data.site.id}&key=${m}&content_type=${y.type}`);return await Ve.put(P.signed,y,{headers:{"Content-Type":y.type}}),{url:P.url}}});const l=e.data.user.email,c=ye.channel(e.data.site.id,{config:{presence:{key:l}}});c.subscribe(async w=>{w==="SUBSCRIBED"&&c.track({data:{}})}),c.on("presence",{event:"sync"},()=>{const w=c.presenceState();we(Lt,re(Object.entries(w).map(([m,y])=>({email:m})).filter(m=>m.email!==e.data.user.email))),we(ja,re(Object.entries(w).flatMap(([m,y])=>y.map(({data:C,instance:P})=>({key:m,block_id:C.active_block,instance:P}))).filter(m=>m.block_id)))}).on("broadcast",{event:"save"},w=>{var m;w.payload.page_id===((m=e.data.page)==null?void 0:m.id)&&Qa("app:data")}),Fa(async w=>{c.track({instance:w.instance,user:w.user,data:w.data})}),Ma(async w=>{c.send({type:"broadcast",event:"save",payload:w})});let v=oe(void 0);ia(()=>{Q(v,re(o().url.searchParams.get("subscription"))),Fe(window.location.pathname,{replaceState:!0})}),It(()=>{t(v)==="CUSTOM_DOMAIN"||t(v)==="FORMS"||t(v)});let k=[];var B=V(()=>[{icon:"solar:pallete-2-bold",label:"Design",onclick:()=>Ye({id:"DESIGN",options:{height:"100%"}})}]),j=V(()=>[{icon:"fluent:form-multiple-48-filled",label:"Form Builder",onclick:()=>Ye({id:"USER_FORMS",options:{max_width:"500px"}})}]),D=V(()=>[{icon:"clarity:users-solid",label:"Editors",onclick:()=>{Ye({id:"COLLABORATION",options:{max_width:"500px"}})}}]);gi(n,{get data(){return e.data},get role(){return e.data.role},primo_symbols:k,get primary_buttons(){return t(B)},get dropdown(){return t(j)},get secondary_buttons(){return t(D)},$$events:{publish:()=>Ye({id:"DEPLOY",options:{max_width:"700px"}})},children:(w,m)=>{var y=H(),C=N(y);Me(C,()=>e.children??Ke),f(w,y)},$$slots:{default:!0}}),me()}export{Li as component,Ii as universal};
